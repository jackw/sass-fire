kind: pipeline
type: docker
name: default

steps:
  - name: install dependencies
    image: node
    commands:
    - yarn --frozen-lockfile

  - name: lint
    image: node
    commands:
    - yarn lint

  - name: test
    image: node
    commands:
    - yarn test

  - name: semantic-release
    image: gtramontina/semantic-release:17.0.7
    environment:
      GH_TOKEN:
        from_secret: GH_TOKEN
      NPM_TOKEN:
        from_secret: NPM_TOKEN
    entrypoint:
      - semantic-release
    when:
      branch: master
      event: push

  - name: trigger
    image: plugins/downstream
    settings:
      server: http://drone
      token:
        from_secret: downstream_token
      fork: true
      repositories:
        - jackw/sass-fire.io
    when:
      branch: master
      event: push